/*
 * Copyright 2014 CEL UK
 */
package celtech.roboxbase.comms;

import celtech.roboxbase.printerControl.model.HeaterMode;
import celtech.roboxbase.printerControl.model.HardwarePrinter;
import celtech.roboxbase.utils.BaseEnvironmentConfiguredTest;
import org.junit.Test;
import static org.junit.Assert.*;
import org.junit.ClassRule;
import org.junit.rules.TemporaryFolder;

/**
 *
 * @author tony
 */
public class DummyPrinterCommandInterfaceTest extends BaseEnvironmentConfiguredTest
{

    private DetectedDevice printerHandle = new DetectedDevice(DeviceDetector.PrinterConnectionType.SERIAL, "Test Printer");

    @ClassRule
    public static TemporaryFolder temporaryUserStorageFolder = new TemporaryFolder();

    @Test
    public void testSetNozzleTargetTemperature() throws Exception
    {
        StatusConsumer statusConsumer = new StatusConsumer();
        DummyPrinterCommandInterface commandInterface = new DummyPrinterCommandInterface(
                statusConsumer, printerHandle, false, 500);
        HardwarePrinter hardwarePrinter = new HardwarePrinter(statusConsumer, commandInterface);
        commandInterface.setPrinter(hardwarePrinter);
        commandInterface.connectToPrinter();

        hardwarePrinter.sendRawGCode("ATTACH HEAD RBX01-DM", true);
        commandInterface.doStatusRequest();

        hardwarePrinter.setNozzleHeaterTargetTemperature(0, 200);

        assertEquals(200, commandInterface.nozzleTargetTemperatureS);

//        NozzleHeater nozzleHeater = hardwarePrinter.headProperty().get().getNozzleHeaters().get(0);
//        assertEquals(200, nozzleHeater.nozzleTargetTemperatureProperty().get());
    }

    //@Test DISABLED23/09/15
    public void testGotoTargetNozzleTemperature() throws Exception
    {
        StatusConsumer statusConsumer = new StatusConsumer();
        DummyPrinterCommandInterface commandInterface = new DummyPrinterCommandInterface(
                statusConsumer, printerHandle, false, 500);
        HardwarePrinter hardwarePrinter = new HardwarePrinter(statusConsumer, commandInterface);
        commandInterface.setPrinter(hardwarePrinter);
        hardwarePrinter.goToTargetNozzleHeaterTemperature(0);

        assertEquals(HeaterMode.NORMAL, commandInterface.nozzleHeaterModeS);

    }

    //@Test DISABLED23/09/15
    public void testSwitchAllNozzleHeatersOff() throws Exception
    {
        StatusConsumer statusConsumer = new StatusConsumer();
        DummyPrinterCommandInterface commandInterface = new DummyPrinterCommandInterface(
                statusConsumer, printerHandle, false, 500);
        HardwarePrinter hardwarePrinter = new HardwarePrinter(statusConsumer, commandInterface);
        commandInterface.setPrinter(hardwarePrinter);

        hardwarePrinter.goToTargetNozzleHeaterTemperature(0);
        assertEquals(HeaterMode.NORMAL, commandInterface.nozzleHeaterModeS);
        hardwarePrinter.switchAllNozzleHeatersOff();
        assertEquals(HeaterMode.OFF, commandInterface.nozzleHeaterModeS);

    }

    class StatusConsumer implements PrinterStatusConsumer
    {

        @Override
        public void printerConnected(DetectedDevice printerHandle)
        {
        }

        @Override
        public void failedToConnect(DetectedDevice printerHandle)
        {
        }

        @Override
        public void disconnected(DetectedDevice printerHandle)
        {
        }
    }

}
